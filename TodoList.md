# КРИТИЧЕСКИЕ ИСПРАВЛЕНИЯ ПЛАТФОРМЫ INVESTEX - TODOLIST

## ПРИОРИТЕТ 1: ИСПРАВЛЕНИЕ СИСТЕМЫ АВТОРИЗАЦИИ И РЕГИСТРАЦИИ

### Система ролей и типов пользователей
- [x] 1.1 Создать enum UserRole с 8 основными ролями
- [x] 1.2 Обновить таблицу profiles с новыми ролями
- [x] 1.3 Создать таблицу user_roles для множественных ролей
- [x] 1.4 Создать таблицу organization_types
- [x] 1.5 Создать таблицу registration_methods

### Роли пользователей - детальная настройка
- [ ] 1.6 Настроить регистрацию ИНВЕСТОРА (частное лицо/организация)
- [ ] 1.7 Настроить регистрацию ФАУНДЕРА (частное лицо/организация)
- [ ] 1.8 Настроить ограниченную регистрацию АДМИНИСТРАТОРА ПРОЕКТА (только по ссылке/добавлению)
- [ ] 1.9 Настроить ограниченную регистрацию СОТРУДНИКА ПРОЕКТА (только по ссылке/добавлению)
- [ ] 1.10 Настроить регистрацию ФРИЛАНСЕРА (только частное лицо)
- [ ] 1.11 Настроить регистрацию АУТСОРСЕРА (частное лицо/организация)
- [ ] 1.12 Настроить регистрацию ПОДРЯДЧИКА (частное лицо/организация)
- [ ] 1.13 Настроить системные роли (ADMIN/SUPER_ADMIN)

### Ограничения доступа
- [ ] 1.14 Создать middleware для проверки доступа к проектам
- [ ] 1.15 Ограничить доступ PROJECT_ADMIN только к назначенным проектам
- [ ] 1.16 Ограничить доступ PROJECT_EMPLOYEE только к назначенным проектам
- [ ] 1.17 Создать систему invitation tokens для ограниченных ролей
- [ ] 1.18 Автоматическое добавление в проект после регистрации по ссылке

## ПРИОРИТЕТ 1.5: МЕХАНИЗМ ВОССТАНОВЛЕНИЯ ЗАБЫТОГО ПАРОЛЯ

### База данных для восстановления пароля
- [x] 1.19 Создать таблицу password_reset_requests
- [x] 1.20 Добавить индексы для оптимизации запросов
- [x] 1.21 Настроить автоочистку устаревших токенов

### Backend для восстановления пароля
- [x] 1.22 Создать edge function для запроса восстановления пароля
- [ ] 1.23 Создать edge function для сброса пароля
- [ ] 1.24 Создать edge function для проверки токена
- [ ] 1.25 Настроить rate limiting (3 запроса в 15 минут)
- [ ] 1.26 Настроить email уведомления через Resend

### Frontend для восстановления пароля
- [ ] 1.27 Создать страницу /forgot-password
- [ ] 1.28 Создать страницу /reset-password/:token
- [ ] 1.29 Создать компонент ForgotPasswordForm
- [ ] 1.30 Создать компонент ResetPasswordForm
- [ ] 1.31 Создать компонент PasswordStrengthIndicator
- [ ] 1.32 Добавить ссылку "Забыли пароль?" в форму входа
- [ ] 1.33 Добавить обработку ошибок и валидацию

### Интеграция с существующей системой авторизации
- [ ] 1.34 Обновить useAuth hook для поддержки восстановления пароля
- [ ] 1.35 Обновить Auth.tsx с формой восстановления пароля
- [ ] 1.36 Добавить маршруты в App.tsx

## ПРИОРИТЕТ 2: ЛИЧНЫЕ КАБИНЕТЫ (10 ТИПОВ)

### Кабинет ИНВЕСТОРА
- [ ] 2.1 Создать InvestorDashboard с портфелем инвестиций
- [ ] 2.2 Добавить поиск проектов с фильтрами
- [ ] 2.3 Создать Due diligence инструменты
- [ ] 2.4 Добавить аналитику доходности
- [ ] 2.5 Создать систему сообщений от фаундеров
- [ ] 2.6 Интегрировать календарь встреч/питчей

### Кабинет ФАУНДЕРА
- [ ] 2.7 Создать FounderDashboard с управлением проектами
- [ ] 2.8 Добавить создание/редактирование проектов
- [ ] 2.9 Создать поиск инвесторов
- [ ] 2.10 Добавить управление командой
- [ ] 2.11 Создать систему приглашений администраторов и сотрудников
- [ ] 2.12 Добавить финансовые метрики
- [ ] 2.13 Создать Pitch deck менеджер
- [ ] 2.14 Интегрировать календарь встреч

### Кабинет АДМИНИСТРАТОРА ПРОЕКТА (ограниченный)
- [ ] 2.15 Создать ProjectAdminDashboard с ограниченным доступом
- [ ] 2.16 Добавить управление назначенными проектами
- [ ] 2.17 Создать управление командой проекта
- [ ] 2.18 Добавить задачи и дедлайны проекта
- [ ] 2.19 Создать управление бюджетом и расходами
- [ ] 2.20 Добавить систему отчетов для фаундера
- [ ] 2.21 Создать коммуникации внутри проекта
- [ ] 2.22 Заблокировать доступ к общим разделам платформы

### Кабинет СОТРУДНИКА ПРОЕКТА (ограниченный)
- [ ] 2.23 Создать ProjectEmployeeDashboard с ограниченным доступом
- [ ] 2.24 Добавить мои задачи в назначенных проектах
- [ ] 2.25 Создать коммуникацию с командой проекта
- [ ] 2.26 Добавить отчеты о выполненной работе
- [ ] 2.27 Интегрировать календарь и дедлайны проекта
- [ ] 2.28 Добавить файлы и документы проекта
- [ ] 2.29 Создать учет рабочего времени
- [ ] 2.30 Заблокировать доступ к общим разделам платформы

### Остальные кабинеты
- [ ] 2.31 Обновить FreelancerDashboard (поиск проектов, портфолио, активные задачи)
- [ ] 2.32 Создать OutsourcerDashboard (управление командой, крупные проекты)
- [ ] 2.33 Создать ContractorDashboard (специализированные услуги, сертификации)
- [ ] 2.34 Обновить SuperadminDashboard (управление платформой)
- [ ] 2.35 Создать SystemAdminDashboard (управление платформой)

### Навигация и маршрутизация
- [ ] 2.36 Обновить Dashboard.tsx с правильной маршрутизацией по ролям
- [ ] 2.37 Создать защищенные маршруты с проверкой ролей
- [ ] 2.38 Добавить переключение между ролями (если у пользователя несколько)

## ПРИОРИТЕТ 3: МНОЖЕСТВЕННЫЕ РОЛИ И ПРЕДУПРЕЖДЕНИЯ

### Система множественных ролей
- [ ] 3.1 Создать таблицу для множественных ролей пользователя
- [ ] 3.2 Добавить переключение между активными ролями
- [ ] 3.3 Создать middleware для проверки текущей активной роли

### Система предупреждений о конфликтах
- [ ] 3.4 Создать функцию checkRoleConflicts
- [ ] 3.5 Добавить предупреждения при создании дополнительной роли
- [ ] 3.6 Создать систему уведомлений фаундеров о конфликтах интересов
- [ ] 3.7 Добавить модальные окна с подтверждением при конфликтах ролей

## ПРИОРИТЕТ 4: ИСПРАВЛЕНИЕ 404 ОШИБОК

### Создание недостающих страниц
- [ ] 4.1 Создать страницу /knowledge-base (База знаний)
- [ ] 4.2 Создать страницу /api-docs (API документация)
- [ ] 4.3 Создать страницу /security (Политика безопасности)
- [ ] 4.4 Создать страницу /terms (Пользовательское соглашение)
- [ ] 4.5 Создать страницу /privacy (Политика конфиденциальности)
- [ ] 4.6 Создать страницу /cookies (Cookie-политика)
- [ ] 4.7 Добавить маршруты в App.tsx
- [ ] 4.8 Обновить Navigation.tsx с ссылками на новые страницы

## ПРИОРИТЕТ 5: БЭКЕНД ПРОЕКТОВ

### Таблицы базы данных
- [ ] 5.1 Создать обновленную таблицу projects
- [ ] 5.2 Создать таблицу project_team
- [ ] 5.3 Создать таблицу project_invitations
- [ ] 5.4 Добавить RLS политики для проектов

### Edge Functions для проектов
- [ ] 5.5 Создать edge function для создания проекта (POST /api/projects)
- [ ] 5.6 Создать edge function для получения проекта (GET /api/projects/:id)
- [ ] 5.7 Создать edge function для обновления проекта (PUT /api/projects/:id)
- [ ] 5.8 Создать edge function для удаления проекта (DELETE /api/projects/:id)
- [ ] 5.9 Создать edge function для приглашения админа (POST /api/projects/:id/invite-admin)
- [ ] 5.10 Создать edge function для приглашения сотрудника (POST /api/projects/:id/invite-employee)
- [ ] 5.11 Создать edge function для списка команды (GET /api/projects/:id/team)
- [ ] 5.12 Создать edge function для обновления разрешений (PUT /api/projects/:id/team/:userId/permissions)
- [ ] 5.13 Создать edge function для удаления из команды (DELETE /api/projects/:id/team/:userId)

### Система приглашений
- [ ] 5.14 Создать генерацию уникальных одноразовых ссылок
- [ ] 5.15 Добавить валидацию приглашений по токенам
- [ ] 5.16 Создать страницы для принятия приглашений
- [ ] 5.17 Автоматическое добавление в проект после принятия приглашения

## ПРИОРИТЕТ 6: ИСПРАВЛЕНИЕ ФРОНТЕНДА

### Исправление дашбордов
- [ ] 6.1 Исправить роутинг к личным кабинетам в App.tsx
- [ ] 6.2 Добавить проверку авторизации в защищенные маршруты
- [ ] 6.3 Исправить отображение компонентов дашбордов
- [ ] 6.4 Добавить loading состояния
- [ ] 6.5 Обработать ошибки загрузки данных

### Исправление элементов управления
- [ ] 6.6 Проверить все кнопки на функциональность
- [ ] 6.7 Исправить обработчики событий форм
- [ ] 6.8 Добавить валидацию всех форм
- [ ] 6.9 Обеспечить feedback пользователю (тосты, модалки)
- [ ] 6.10 Исправить навигацию между страницами

### Обновление существующих компонентов
- [ ] 6.11 Обновить Navigation.tsx с новыми ссылками
- [ ] 6.12 Обновить Footer.tsx
- [ ] 6.13 Исправить useAuth hook
- [ ] 6.14 Обновить LanguageContext для новых ролей

## ПРИОРИТЕТ 7: СХЕМА БД (финальная версия)

### Миграции базы данных
- [ ] 7.1 Создать миграцию для обновления enum user_role
- [ ] 7.2 Создать миграцию для таблицы organization_types
- [ ] 7.3 Создать миграцию для таблицы registration_methods
- [ ] 7.4 Создать миграцию для обновленной таблицы profiles
- [ ] 7.5 Создать миграцию для таблицы user_roles
- [ ] 7.6 Создать миграцию для обновленной таблицы projects
- [ ] 7.7 Создать миграцию для таблицы project_team
- [ ] 7.8 Создать миграцию для таблицы password_reset_requests
- [ ] 7.9 Создать все необходимые индексы
- [ ] 7.10 Обновить RLS политики

### Функции базы данных
- [ ] 7.11 Создать функции для проверки ролей
- [ ] 7.12 Создать функции для управления проектными командами
- [ ] 7.13 Создать триггеры для автоматических действий
- [ ] 7.14 Создать функции для валидации доступа

## ВАЛИДАЦИЯ И ТЕСТИРОВАНИЕ

### Тестирование авторизации
- [ ] 8.1 Протестировать регистрацию для каждой роли
- [ ] 8.2 Протестировать систему восстановления пароля (запрос, email, установка)
- [ ] 8.3 Протестировать ограничения регистрации для проектных ролей
- [ ] 8.4 Протестировать автоматическое добавление в проект после регистрации
- [ ] 8.5 Протестировать ограничения доступа к системе для проектных ролей

### Тестирование множественных ролей
- [ ] 8.6 Протестировать систему предупреждений при создании дополнительных ролей
- [ ] 8.7 Протестировать уведомления фаундеров о конфликтах интересов
- [ ] 8.8 Протестировать middleware проверки доступа на каждый запрос
- [ ] 8.9 Протестировать корректное переключение между ролями с ограничениями

### Тестирование проектной системы
- [ ] 8.10 Протестировать добавление пользователей двумя способами (ссылка/прямое добавление)
- [ ] 8.11 Протестировать валидацию доступа к конкретным проектам
- [ ] 8.12 Протестировать отображение ограниченных интерфейсов для проектных ролей
- [ ] 8.13 Протестировать rate limiting для восстановления пароля

### Финальное тестирование
- [ ] 8.14 Протестировать доступность всех страниц (нет 404)
- [ ] 8.15 Протестировать работоспособность всех форм и кнопок
- [ ] 8.16 Провести end-to-end тестирование основных пользовательских сценариев
- [ ] 8.17 Протестировать безопасность и авторизацию
- [ ] 8.18 Протестировать производительность
- [ ] 8.19 Протестировать мобильную адаптивность
- [ ] 8.20 Финальная проверка всех критических функций

---

**ВАЖНО:** Перед выполнением каждой задачи проверяйте этот список и отмечайте выполненные пункты. Выполняйте только невыполненные задачи.